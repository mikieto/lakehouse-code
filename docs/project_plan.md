
# Project Plan — *Starter Lakehouse*  2025-05-15

> **Mission** – Provide a *Starter Lakehouse* any learner can  
> spin-up, query and tear down in **≤ 30 minutes** for **≤ USD 20 per month**,  
> while practising a production-grade, cloud-native Dev → CI → Prod flow.  

---

## 1  Purpose (WHY)

First win in 30 minutes → safe deep-dives into ETL, CDC, FinOps, DR, SRE …

### 1.1 Guiding Principles — Golden Template

We apply the **Golden Template** strategy:

| Principle | How we realise it |
|-----------|-------------------|
| Official-first | `actions/starter-workflows` & `terraform-aws-modules/*` are **forked** into our GitHub org. |
| Thin-custom | Cost guard (Infracost & AWS Budgets) and security guard (tfsec, Trivy, cosign) are added as reusable workflows in **`ci/workflows/`**. |
| Single Source of Truth | `make sync-ci` copies reusable workflows into `.github/workflows/`. Docs blocks are synced via `scripts/sync_exit_block.py`. |
| Self-service | `make new-module name=...` runs Cookiecutter to scaffold Terraform modules with pre-commit hooks. |
| Evergreen | Monthly `gh workflow run dependabot` keeps forks in sync with upstream. |

*These principles underpin every sprint and CI check.*

> **Offline Distribution** – Release pipeline runs `make bundle`, vendoring all forked Terraform modules into `infra/_vendor/` and rewriting `source` paths. This guarantees the 30-minute hands-on works even in air-gapped environments.

---

## 2  Scope / Out-of-Scope

| Included | Excluded |
|----------|----------|
| Serverless storage, ETL/ELT, lineage, security & cost guard-rails | Non-AWS clouds, on-prem-only connectors |
| IaC & CI/CD best practice, FinOps basics | Ultra-PB tuning, vendor-specific BI tweaks |
| Cross-Region DR (S3 CRR + LakeFS) | Multi-cloud active-active DR |

---

## 3  Exit Criteria — **`starter-done`**

Exit Criteria → ../README.md

*Any commit passing all seven checks is tagged **`starter-done`** and the base is frozen.*

---

## 4  Roadmap & Sprints

Here’s the re-balanced Roadmap with the two fixes applied:

| Sprint                 | Focus                                       | Exit # (target to achieve) | Key CI Jobs                                      | Owner            |
| ---------------------- | ------------------------------------------- | -------------------------- | ------------------------------------------------ | ---------------- |
| **S-0** Bootstrap      | DevContainer setup & local smoke tests      | – (preparatory)            | `ci_smoke_local`                                 | Dev Experience   |
| **S-1** Starter Core   | Fully serverless stack deployed in ≤ 30 min | **#1 #2 #5**               | `ci_plan_apply`, `ci_smoke_aws`, `ci_guard`      | Platform SRE     |
| **S-2** Quality Gate   | dbt + Great Expectations hard-fail gate     | **#3 #6**                  | `ci_dbt_test`, `ci_expectations`, `ci_guard`     | Data Engineering |
| **S-3** CDC & Events   | MSK Serverless + Debezium streaming         | **#4**                     | `ci_cdc_latency`, `ci_lineage_check`             | Data Engineering |
| **S-4** Observability  | EMF → Grafana dashboards & cost alerts      | **#7**                     | `ci_observability`, `ci_finops_alert`            | SecOps           |
| **S-5** Dev & SRE      | Incident drill & automated post-mortem      | *maintain #3*              | `ci_incident_review`, `ci_guard`                 | DevOps           |
| **S-6** DR & Backup    | Cross-Region Replication + LakeFS switch    | *maintain #5 (IaC), #7*    | `ci_backup_check`, `ci_observability`, `ci_guard`| Platform SRE     |
| **S-7** Dev Portal     | Backstage on EKS / Fargate                  | *maintain #3*              | `ci_portal_build`, `ci_guard`                    | Dev Experience   |
| **S-8** Release Freeze | Final release, docs sync, and hand-over     | **all Exit #1-#7**         | manual checks + CI                               | Whole Team       |

*“maintain” indicates the sprint must keep the already-met Exit Criteria green; the listed CI jobs enforce that.*

---

## 5  Repository Structure (Flat 3-Box + Portal)

```text
lakehouse-code/
├── ci/                    # GitHub Actions workflows
├── infra/                 # Terraform modules & *.tfvars
├── pipelines/             # run_demo_queries.sh, dbt, CDC, incident drill …
│   ├── tests/             # lakeformation_mask.sql
│   └── local_dev/         # MinIO + DuckDB sandbox
├── portal/                # Developer portal app (Backstage)
├── docs/                  # ci_walkthrough.md, budget_alarm.md …
├── .devcontainer/         # Single-image build → GHCR
├── .github/               # ISSUE_TEMPLATE, CODEOWNERS, SECURITY.md
├── .gitmessage            # Conventional-Commit template (≥2 lines)
├── CHANGELOG.md           # Auto-generated by release-please
└── project_plan.md        # ← this file
```

*Keep the top level flat; new assets live inside one of the three boxes.*

---

## 6  Environments

| Layer               | Purpose         | Key Points                                |
| ------------------- | --------------- | ----------------------------------------- |
| Local               | Rapid debug     | Dev Container ⇄ GHCR image                |
| GitHub CI           | Quality gate    | Five mandatory jobs + consistency checker |
| AWS dev             | Learner sandbox | workspace =`dev`, StopSpend ≤ USD 20      |
| AWS prod (*opt-in*) | DR drill        | Manual approval, workspace =`prod`        |

---

## 7  Development Workflow (learner)

1. Run locally → green smoke
2. Commit – pre-commit hooks pass
3. PR – CI 5 + α jobs green
4. Auto-deploy **dev**  via `ci_plan_apply` + `ci_smoke_aws`
5. *(Optional)* manual approval → prod deploy
   → Full steps in **docs/ci_walkthrough.md**

---

## 8  Git Commit Policy (≥ 2 lines)

- `.gitmessage` template is checked in.
- Dev Container sets it globally on first startup.
- `gitlint` (pre-commit) blocks single-line commits.

---

## 9  CI Pipeline Overview

See `docs/ci_walkthrough.md`.

---

## 10  Ownership

| Area          | Primary       | Review        |
| ------------- | ------------- | ------------- |
| Terraform     | @platform-sre | @secops       |
| Pipelines/dbt | @data-eng     | @platform-sre |
| CI & DevEx    | @devops       | @editor       |
| Portal        | @devops       | @platform-sre |

---

## 11  Risks & Mitigations

| Risk              | Impact              | Mitigation                     |
| ----------------- | ------------------- | ------------------------------ |
| Deploy > 30 min   | Exit #1 fails       | optimise TF, fully serverless  |
| Cost spike        | Learner churn       | StopSpend, nightly `make nuke` |
| Docs ↔ code drift | Wrong learning path | consistency checker hard-fail  |

---

## 12  Change Log

Managed by **release-please** — manual edits forbidden.

| Date       | Author  | Summary                                                            |
| ---------- | ------- | ------------------------------------------------------------------ |
| 2025-05-16 | @editor | README repo table DRY'ed; direct push allowed for docs.            |
| 2025-05-15 | @editor | repo flatten & P0 completed                                        |
| 2025-05-15 | @editor | Flattened repo; portal folder; CI/Docs links; two-phase workflow   |
| 2025-05-11 | @editor | Mark plan.md as canonical for Exit Criteria; added BEGIN/END block |

---

## Appendix A — Outline & CI Links

- CI ↔ Chapter ↔ Principles table → **docs/ci_walkthrough.md**
